--[[ 
CAD CONNECT BY CODURLY
NOT FOR DISTRUBTION WITHOUT WRITTEN CONSENT BY CODURLY
COPYRIGHT 2018
--]]

local a={}local b=Config.SecretID;local c=Config.PrintSuccess;local d=Config.ESXProperties;local e=Config.ServerNumber;local f=Config.APIURL;ESX=nil;TriggerEvent('esx:getSharedObject',function(g)ESX=g end)RegisterServerEvent("cadConnect:911")AddEventHandler("cadConnect:911",function(h,j,k)PerformHttpRequest(f..'/api/1.1/wf/911',function(l,m,n)if c then print(os.date("%X",os.time()).." cadConnect: 911 API Called, Response - \n"..m)end end,'POST',json.encode({authorization=b,server=e,callerName=k,street=h,cross=j}),{["Content-Type"]='application/json'})CancelEvent()end)RegisterServerEvent("cadConnect:Panic")AddEventHandler("cadConnect:Panic",function(h,j,k)PerformHttpRequest(f..'/api/1.1/wf/Panic',function(l,m,n)if c then print(os.date("%X",os.time()).." cadConnect: Panic Button API Called, Response - \n"..m)end end,'POST',json.encode({authorization=b,server=e,callerName=k,street=h,cross=j}),{["Content-Type"]='application/json'})CancelEvent()end)AddEventHandler('chatMessage',function(o,p,q)mes=stringsplit(q," ")if mes[1]=="/911"then CancelEvent()local k=GetPlayerName(o)TriggerClientEvent("cadConnect:Communication",o,k,"911")else if mes[1]=="/panic"then CancelEvent()local k=GetPlayerName(o)TriggerClientEvent("cadConnect:Communication",o,k,"panic")end end end)function printMsg(r)print("CADconnect: "..r)end;SetHttpHandler(function(s,t)function returnError(u)print(os.date("%X",os.time()).." CADconnect - Rejected request for: "..u)return t.send(json.encode({success=false,reason=u}))end;function returnSuccess()if c then print(os.date("%X",os.time()).." CADconnect - Successful "..s.path.." request for: "..GetPlayerName(player))end;return t.send(json.encode({success=true}))end;local v=s.path;if s.method=='POST'then if s.headers['Authorization']==nil then return returnError("No Authorization key provided! ERR: 1A")else if s.headers['Authorization']~=b then return returnError("Invalid authorization key! ERR: 1B")end end;if#ESX.GetPlayers()==0 then return returnError("No players online! ERR: 2A")end;s.setDataHandler(function(w)local x=json.decode(w)local y=x.hex;if y==nil then return returnError("Missing HEX Parameter! ERR: 1C")end;player=ESX.GetPlayerFromIdentifier(y)if player==nil then return returnError("No players matching provided HEX! ERR: 2B")end;player=player.source;xPlayer=ESX.GetPlayerFromId(player)if s.path=='/SendNotification'then if x.title==nil or x.message==nil then return returnError("Missing parameters! ERR: 1C")else TriggerClientEvent("cadConnect:alert",player,x.title,x.message)return returnSuccess()end end;if s.path=='/AddMoney'then if x.amount==nil then return returnError("Missing parameters! ERR: 1C")else xPlayer.addMoney(x.amount)return returnSuccess()end end;if s.path=='/RemoveMoney'then if x.amount==nil then return returnError("Missing parameters! ERR: 1C")else xPlayer.removeMoney(x.amount)return returnSuccess()end end;if s.path=='/Teleport'then if x.x==nil or x.y==nil or x.z==nil then return returnError("Missing parameters! ERR: 1C")else TriggerClientEvent("cadConnect:teleport",player,x.x,x.y,x.z)return returnSuccess()end end;if s.path=='/SendToJail'then TriggerClientEvent("cadConnect:sendToJail",player,x.x,x.y,x.z)return returnSuccess()end;if s.path=='/kickplayer'then if x.reason==nil then return returnError("Missing parameters! ERR: 1C")else DropPlayer(player,x.reason)return t.send(json.encode({success=true}))end end;if d then if s.path=='/BuyProperty'then if x.propertyName==nil or x.price==nil then return returnError("Missing parameters! ERR: 1C")else if xPlayer.getMoney()>x.price then xPlayer.removeMoney(x.price)TriggerEvent("esx_property:setPropertyOwned",x.propertyName,x.price,false,y)return returnSuccess()else return returnError("Not enough money to purchase! ERR: 2C")end end end;if s.path=='/RemoveProperty'then if x.propertyName==nil then return returnError("Missing parameters! ERR: 1C")else TriggerEvent("esx_property:removeOwnedPropertyIdentifier",x.propertyName,y)return returnSuccess()end end end;if s.path=='/BuyWeapon'then if x.weaponName==nil or x.price==nil then return returnError("Missing parameters! ERR: 1C")else if xPlayer.getMoney()>x.price then xPlayer.removeMoney(x.price)xPlayer.addWeapon(x.weaponName)return returnSuccess()else return returnError("Not enough money to purchase! ERR: 2C")end end end;if s.path=='/RemoveWeapon'then if x.weaponName==nil then return returnError("Missing parameters! ERR: 1C")else xPlayer.removeMoney(x.price)xPlayer.removeWeapon(x.weaponName)return returnSuccess()end end;return returnError("Path '"..s.path.."' not found! ERR: 1D")end)else return returnError("Invalid method! Must be POST! ERR: 1E")end end)function stringsplit(z,A)if A==nil then A="%s"end;local B={}i=1;for C in string.gmatch(z,"([^"..A.."]+)")do B[i]=C;i=i+1 end;return B end